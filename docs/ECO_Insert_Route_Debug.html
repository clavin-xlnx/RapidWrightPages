

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-117897999-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Inserting and Routing a Debug Core As An ECO &mdash; RapidWright 2023.2.2-beta documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/RapidWrightGear32.ico"/>
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Create Placed and Routed DCP to Cross SLR" href="SLR_Crosser_DCP_Creator_Tutorial.html" />
    <link rel="prev" title="Polynomial Generator: Placed and Routed Circuits in Seconds" href="PolynomialGenerator.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

		  
		  
            
            <a href="http://rapidwright.io"><img src="_static/rwlogo_xsm_black.png" class="logo" alt="Logo"/></a><br/>
          
		  
          
            <a href="index.html" class="icon icon-home"> RapidWright Docs
          
          </a>
		  
          
            
            
              <div class="version">
                2023.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting_Started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="FPGA_Architecture.html">FPGA Architecture Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Xilinx_Architecture.html">Xilinx Architecture Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="RapidWright_Overview.html">RapidWright Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="Design_Checkpoints.html">Design Checkpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="Implementation_Basics.html">Implementation Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Merge_Designs.html">Merging Designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bitstream_Manipulation.html">Bitstream Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="FPGA_Interchange_Format.html">FPGA Interchange Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="Papers.html">RapidWright Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="PreImplemented_Module_Flow.html">A Pre-implemented Module Flow</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Tutorials.html">RapidWright Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="RWRoute_timing_driven_routing.html">RWRoute Timing-driven Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="RWRoute_wirelength_driven_routing.html">RWRoute Wirelength-driven Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="RWRoute_partial_routing.html">RWRoute Partial Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="ReportTimingExample.html">RapidWright Report Timing Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="ReusingTimingClosedLogicAsAShell.html">Reuse Timing-closed Logic As A Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="Use_DREAMPlaceFPGA_via_FPGA_Interchange_Format.html">Use DREAMPlaceFPGA to Place a Netlist via FPGA Interchange Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="PolynomialGenerator.html">Polynomial Generator: Placed and Routed Circuits in Seconds</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Inserting and Routing a Debug Core As An ECO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#context">Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">1. Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup">2. Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inserting-the-debug-core-into-a-place-and-routed-design">3. Inserting the debug core into a place-and-routed design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connecting-the-debug-core">4. Connecting the debug core</a></li>
<li class="toctree-l4"><a class="reference internal" href="#relocating-the-debug-core">5. Relocating the debug core</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inserting-and-routing-multiple-debug-cores">6. Inserting and routing multiple debug cores</a></li>
<li class="toctree-l4"><a class="reference internal" href="#inserting-and-routing-debug-cores-without-leaving-vivado">7. Inserting and routing debug cores without leaving Vivado</a></li>
<li class="toctree-l4"><a class="reference internal" href="#closing-comments">8. Closing Comments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SLR_Crosser_DCP_Creator_Tutorial.html">Create Placed and Routed DCP to Cross SLR</a></li>
<li class="toctree-l2"><a class="reference internal" href="IPI_PreImpl_Tutorial.html">Build an IP Integrator Design with Pre-Implemented Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="PipelineGeneratorExample.html">RapidWright PipelineGenerator Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="PipelineGeneratorExampleWithRouting.html">RapidWright PipelineGeneratorWithRouting Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="PreImplemented_Modules_Part_I.html">Pre-implemented Modules - Part I</a></li>
<li class="toctree-l2"><a class="reference internal" href="PreImplemented_Modules_Part_II.html">Pre-implemented Modules - Part II</a></li>
<li class="toctree-l2"><a class="reference internal" href="Create_and_Use_an_SLR_Bridge.html">Create and Use an SLR Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA19_Workshop.html">RapidWright FPGA 2019 Deep Dive Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="FCCM19_Workshop.html">RapidWright FCCM 2019 Workshop</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPL19_Tutorial.html">RapidWright FPL 2019 Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="ICCAD23_Tutorial.html">RapidWright ICCAD 2023 Hands-on Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Tech_Articles.html">Tech Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
		<div class="download-links">
			<br/>
			<br/>
			<center>
				<a href="RapidWright.pdf">Download PDF<br/><img src="_static/pdf.svg"/></a>
				<br/>
				<br/>
				<br/>
				<a href="../javadoc/index.html">Javadoc API Reference<br/><img src="_static/javadoc.svg"/></a>
			</center>
		</div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RapidWright Docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="Tutorials.html">RapidWright Tutorials</a> &raquo;</li>
        
      <li>Inserting and Routing a Debug Core As An ECO</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ECO_Insert_Route_Debug.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="inserting-and-routing-a-debug-core-as-an-eco">
<h1>Inserting and Routing a Debug Core As An ECO<a class="headerlink" href="#inserting-and-routing-a-debug-core-as-an-eco" title="Permalink to this headline">¶</a></h1>
<div class="section" id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h2>
<p>An Engineering Change Order, or ECO, is a method that allows small modifications to be made
to an existing design without needing to reimplement it from scratch.
In doing so, by preserving as much of the existing implementation as possible and only making
incremental changes, ECOs can save on compilation runtime.</p>
<p>In this tutorial, we will demonstrate how simple trace-buffer(s) can be rapidly inserted
into an existing place-and-routed design and then unintrusively connected to signals
of interest to aid debugging.</p>
<p>This trace-buffer consists of a FIFO36 primitive configured as a ring-buffer that continuously
samples its 36-bit data input on each clock cycle.
Once the clock is stopped, this trace-buffer will contain a 1024 cycle history of the
activity on those inputs.
Unloading the contents of this trace-buffer is assumed to be realized using the <a class="reference external" href="https://docs.xilinx.com/v/u/en-US/xapp1230-configuration-readback-capture">Readback Capture</a> process, which
leverages built-in configuration resources (as opposed to the user-programmable resources)
to transparently extract the contents of the user state including the contents of block RAMs that
host our FIFO36.</p>
<p>Even though this particular debug core is simplistic, the techniques described in this tutorial
can be extended to more complex cores.
An overview of the sections that follow is shown below:</p>
<a class="reference internal image-reference" href="_images/EcoInsertRouteDebugOverview.png"><img alt="_images/EcoInsertRouteDebugOverview.png" class="align-center" src="_images/EcoInsertRouteDebugOverview.png" style="width: 550px;" /></a>
</div>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prerequisites">
<h3>1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>To run this tutorial, you will need:</p>
<ol class="arabic simple">
<li><p>Java 11 or later</p></li>
<li><p>Vivado 2023.1 or later</p></li>
<li><p><a class="reference external" href="https://git-scm.com/">git</a></p></li>
</ol>
<p>In this tutorial, RapidWright will be used as a precompiled library downloaded from a Java package distribution site (Maven Central).</p>
</div>
<div class="section" id="setup">
<h3>2. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>Start by cloning and entering the tutorial repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/eddieh-xlnx/eco_insert_route_debug
<span class="nb">cd</span><span class="w"> </span>eco_insert_route_debug
</pre></div>
</div>
<p>This repository contains:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.gradle.org/current/userguide/gradle_wrapper.html">The Gradle Wrapper</a> (<code class="docutils literal notranslate"><span class="pre">gradlew</span></code>)
which is a script for launching the <a class="reference external" href="https://gradle.org/)">Gradle Build Tool</a>.</p></li>
<li><p>Gradle settings (<code class="docutils literal notranslate"><span class="pre">build.gradle</span></code>) for this project, indicating what its dependencies
(e.g. RapidWright) are, where to download them from, as well as the location of source files.</p></li>
<li><p>Java sources used in this tutorial (e.g. <code class="docutils literal notranslate"><span class="pre">src/EcoInsertRouteDebug.java</span></code>).</p></li>
<li><p>Example Vivado Design Checkpoints (DCPs) for use in this tutorial.</p></li>
</ul>
<p>The example design that we will be using in this tutorial is an open source RISC-V processor
core by the name of <a class="reference external" href="https://docs.boom-core.org/en/latest/sections/intro-overview/boom.html">Berkeley Out-of-Order Machine</a>
that has been placed-and-routed onto a Xilinx UltraScale+ XCVU3P device.
The configuration used (<code class="docutils literal notranslate"><span class="pre">MediumBoomConfig</span></code>) resulted in a design that occupies around
36,000 LUTs.</p>
<p>This design can be examined by opening it up in Vivado:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vivado<span class="w"> </span>files/boom_medium_routed.dcp
</pre></div>
</div>
<p>Here, the placed and routed result is shown:</p>
<a class="reference internal image-reference" href="_images/boom_medium_routed.png"><img alt="_images/boom_medium_routed.png" class="align-center" src="_images/boom_medium_routed.png" style="width: 550px;" /></a>
<p>Note that only the upper-center part of the device is occupied by the user design, leaving a
significant amount of free resources to aid debug.</p>
<p>Next, we can examine our simplified debug core by also opening it with Vivado.
This debug core was generated from an RTL description and synthesized out-of-context,
placed, and routed as a standard Vivado project.
An <a class="reference external" href="https://docs.xilinx.com/r/en-US/ug949-vivado-design-methodology/Out-of-Context-Synthesis">out-of-context synthesis run</a>
refers to compilation of a sub-module that is intended to be integrated with a top-level
design at some future time. In such a flow, for example, any top-level ports will not have
I/O buffer cells inserted.
Run the following command using the Tcl Console located in the lower portion of the Vivado GUI:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">open_checkpoint</span><span class="w"> </span>files<span class="o">/</span>fifo36_routed.dcp
</pre></div>
</div>
<p>A new window will appear with this design.
Although it may look like the device is empty at first, navigating to “Leaf Cells” in the
“Netlist” tab in the left-hand side of the Vivado GUI and selecting the <code class="docutils literal notranslate"><span class="pre">FIFO36E2_inst</span></code>
element will zoom to the FIFO36 primitive, which is located in the lower-left corner of the
device:</p>
<a class="reference internal image-reference" href="_images/fifo36_routed.png"><img alt="_images/fifo36_routed.png" class="align-center" src="_images/fifo36_routed.png" style="width: 550px;" /></a>
<p>Note that this debug core contains a number of unconnected inputs (specifically, its
write clock and data inputs which are to be connected later to the design under debug)
as well as control inputs (e.g. write enable, sleep, etc.) that are pre-routed to VCC or GND
as appropriate.
In particular, GND is supplied from LUT resources situated to the right of the block RAM
primitive.</p>
<p>Once you are satisfied with the state of both designs, please close both Vivado windows.</p>
<p>In the following sections, we will demonstrate how to use RapidWright to combine both the
base design and the debug core into a single design in a way that preserves the placement
and routing of both.
Additionally, we show how to incrementally connect and re-route the signals of interest
without disrupting this placement and routing, as well as how to instantiate and relocate
multiple debug cores.</p>
</div>
<div class="section" id="inserting-the-debug-core-into-a-place-and-routed-design">
<h3>3. Inserting the debug core into a place-and-routed design<a class="headerlink" href="#inserting-the-debug-core-into-a-place-and-routed-design" title="Permalink to this headline">¶</a></h3>
<p>RapidWright will be used to merge both the base design and the debug core into a single
design without losing any of its existing placement and routing.
The Java code to achieve this is available at <code class="docutils literal notranslate"><span class="pre">src/EcoInsertRouteDebug.java</span></code>, the
relevant parts of which is duplicated below:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">EcoInsertRouteDebug</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Design</span><span class="w"> </span><span class="n">baseDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Design</span><span class="p">.</span><span class="na">readCheckpoint</span><span class="p">(</span><span class="s">&quot;files/boom_medium_routed.dcp&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Design</span><span class="w"> </span><span class="n">debugDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Design</span><span class="p">.</span><span class="na">readCheckpoint</span><span class="p">(</span><span class="s">&quot;files/fifo36_routed.dcp&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">unrouteStaticNets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">Module</span><span class="w"> </span><span class="n">debugModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Module</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span><span class="w"> </span><span class="n">unrouteStaticNets</span><span class="p">);</span>

<span class="w">        </span><span class="n">ModuleInst</span><span class="w"> </span><span class="n">debug1ModuleInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">createModuleInst</span><span class="p">(</span><span class="s">&quot;debug1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">debugModule</span><span class="p">);</span>
<span class="w">        </span><span class="n">debug1ModuleInst</span><span class="p">.</span><span class="na">placeOnOriginalAnchor</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// &lt;&lt; commented out code omitted &gt;&gt;</span>

<span class="w">        </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">writeCheckpoint</span><span class="p">(</span><span class="s">&quot;boom_medium_debug.dcp&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This code describes a Java class with a single “main” method that serves as its
entrypoint when executed.</p>
<p>The first two <code class="docutils literal notranslate"><span class="pre">Design.readCheckpoint()</span></code> calls loads the two DCPs into RapidWright’s
data structures.
Next, the design containing the debug core is converted into a RapidWright
<a class="reference external" href="https://www.rapidwright.io/docs/RapidWright_Overview.html#module">Module</a>
object representing a “template” that can be copied and moved into other designs.
This <code class="docutils literal notranslate"><span class="pre">Module</span></code> object is then instantiated inside the base design (under a level of
hierarchy named <code class="docutils literal notranslate"><span class="pre">debug1</span></code>) and placed at its original location.
Lastly, the newly merged design is written to disk.</p>
<p>Compile and run this source code with the following command that invokes the Gradle wrapper,
and then open Vivado (in the background) to examine the generated DCP:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./gradlew<span class="w"> </span>-Dmain<span class="o">=</span>EcoInsertRouteDebug<span class="w"> </span>:run
vivado<span class="w"> </span>boom_medium_debug.dcp<span class="w"> </span><span class="p">&amp;</span>
</pre></div>
</div>
<p>Once again, it is not immediately obvious that the debug core has been merged in
with the base design; select “debug1 &gt; Leaf Cells -&gt; FIFO36E2_inst” from the left-hand
“Netlist” tab to verify its existence and location.
The following image shows the result after zooming out six steps:</p>
<a class="reference internal image-reference" href="_images/boom_medium_debug1.png"><img alt="_images/boom_medium_debug1.png" class="align-center" src="_images/boom_medium_debug1.png" style="width: 550px;" /></a>
<p>To verify the state of the design,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">report_route_status</span>
</pre></div>
</div>
<p>can be run in the Vivado Tcl Console to give the following result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">report_route_status</span>
<span class="n">Design</span> <span class="n">Route</span> <span class="n">Status</span>
                                               <span class="p">:</span>      <span class="c1"># nets :</span>
   <span class="o">-------------------------------------------</span> <span class="p">:</span> <span class="o">-----------</span> <span class="p">:</span>
   <span class="c1"># of logical nets.......................... :       87712 :</span>
       <span class="c1"># of nets not needing routing.......... :       33882 :</span>
           <span class="c1"># of internally routed nets........ :       30546 :</span>
           <span class="c1"># of nets with no loads............ :        3299 :</span>
       <span class="c1"># of routable nets..................... :       53830 :</span>
           <span class="c1"># of fully routed nets............. :       53830 :</span>
       <span class="c1"># of nets with routing errors.......... :          37 :</span>
           <span class="c1"># of nets with no driver........... :          37 :</span>
   <span class="o">-------------------------------------------</span> <span class="p">:</span> <span class="o">-----------</span> <span class="p">:</span>


<span class="n">Nets</span> <span class="k">with</span> <span class="n">Routing</span> <span class="n">Errors</span><span class="p">:</span> <span class="p">(</span><span class="n">only</span> <span class="n">the</span> <span class="n">first</span> <span class="mi">10</span> <span class="n">nets</span> <span class="n">are</span> <span class="n">listed</span><span class="p">)</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
  <span class="n">debug1</span><span class="o">/</span><span class="n">DIN</span><span class="p">[</span><span class="mi">18</span><span class="p">]</span>
</pre></div>
</div>
<p>This output is reporting that 37 nets have no driver — these refer to the unconnected
36 data inputs plus its accompanying clock signal.</p>
<p>Please keep Vivado open as we will be reusing it in the next section.</p>
</div>
<div class="section" id="connecting-the-debug-core">
<h3>4. Connecting the debug core<a class="headerlink" href="#connecting-the-debug-core" title="Permalink to this headline">¶</a></h3>
<p>Now that the debug core has been inserted into the base design, the next step is to use
RapidWright to connect and route the signals of interest from the design under debug into the
debug core for tracing.</p>
<p>Return to <code class="docutils literal notranslate"><span class="pre">src/EcoInsertRouteDebug.java</span></code> and uncomment the commented lines of code to get:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">EcoInsertRouteDebug</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Design</span><span class="w"> </span><span class="n">baseDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Design</span><span class="p">.</span><span class="na">readCheckpoint</span><span class="p">(</span><span class="s">&quot;files/boom_medium_routed.dcp&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">Design</span><span class="w"> </span><span class="n">debugDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Design</span><span class="p">.</span><span class="na">readCheckpoint</span><span class="p">(</span><span class="s">&quot;files/fifo36_routed.dcp&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="kt">boolean</span><span class="w"> </span><span class="n">unrouteStaticNets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">Module</span><span class="w"> </span><span class="n">debugModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Module</span><span class="p">(</span><span class="n">debugDesign</span><span class="p">,</span><span class="w"> </span><span class="n">unrouteStaticNets</span><span class="p">);</span>

<span class="w">        </span><span class="n">ModuleInst</span><span class="w"> </span><span class="n">debug1ModuleInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">createModuleInst</span><span class="p">(</span><span class="s">&quot;debug1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">debugModule</span><span class="p">);</span>
<span class="w">        </span><span class="n">debug1ModuleInst</span><span class="p">.</span><span class="na">placeOnOriginalAnchor</span><span class="p">();</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ModuleInst</span><span class="o">&gt;</span><span class="w"> </span><span class="n">debugInsts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">();</span>
<span class="w">        </span><span class="n">debugInsts</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">debug1ModuleInst</span><span class="p">);</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">clkName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;clock_uncore_clock_IBUF_BUFG&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">netNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">36</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">netNames</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;system/tile_prci_domain/tile_reset_domain_tile/core/csr/s1_pc_reg[&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">EDIFNetlist</span><span class="w"> </span><span class="n">baseNetlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">getNetlist</span><span class="p">();</span>
<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">netPinList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildNetPinList</span><span class="p">(</span><span class="n">baseNetlist</span><span class="p">,</span><span class="w"> </span><span class="n">clkName</span><span class="p">,</span><span class="w"> </span><span class="n">netNames</span><span class="p">,</span><span class="w"> </span><span class="n">debugInsts</span><span class="p">);</span>
<span class="w">        </span><span class="n">ECOTools</span><span class="p">.</span><span class="na">connectNet</span><span class="p">(</span><span class="n">baseDesign</span><span class="p">,</span><span class="w"> </span><span class="n">netPinList</span><span class="p">);</span>

<span class="w">        </span><span class="n">PartialRouter</span><span class="p">.</span><span class="na">routeDesignPartialNonTimingDriven</span><span class="p">(</span><span class="n">baseDesign</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>

<span class="w">        </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">writeCheckpoint</span><span class="p">(</span><span class="s">&quot;boom_medium_debug.dcp&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These new lines of code are responsible for connecting nets from the base design to the
debug core.
This includes specifying the base design’s global clock net (named <code class="docutils literal notranslate"><span class="pre">clock_uncore_clock_IBUF_BUFG</span></code>)
that will form the write clock of our debug core, and collecting a list of all program counter (PC) nets
in the RISC-V core (nets <code class="docutils literal notranslate"><span class="pre">system/tile_prci_domain/tile_reset_domain_tile/core/csr/s1_pc_reg[35:0]</span></code>)
to be connected to the debug core’s data inputs.</p>
<p>The mapping of the each net (captured in the <code class="docutils literal notranslate"><span class="pre">netPinList</span></code> member variable) to its debug core input
is done in the <code class="docutils literal notranslate"><span class="pre">buildNetPinList()</span></code> method, which is not shown.
<code class="docutils literal notranslate"><span class="pre">ECOTools.connectNet()</span></code> (a RapidWright method modelled on Vivado’s <code class="docutils literal notranslate"><span class="pre">connect_net</span></code> Tcl API) is then
provided with this mapping and connections are made through the design hierarchy as needed.</p>
<p>Lastly, <code class="docutils literal notranslate"><span class="pre">PartialRouter.routeDesignPartialNonTimingDriven()</span></code> calls a variant of <a class="reference external" href="http://www.rapidwright.io/docs/Implementation_Basics.html#rwroute">RapidWright’s
router (named RWRoute)</a>
that will incrementally route only those newly connected pins using just unoccupied resources,
without disrupting any part of the existing place and route solution.</p>
<p>Re-compile and execute the modified source code by running from the terminal</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./gradlew<span class="w"> </span>-Dmain<span class="o">=</span>EcoInsertRouteDebug<span class="w"> </span>:run
</pre></div>
</div>
<p>again.
Once complete, reload the design in Vivado using the following Tcl command:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">refresh_design</span>
</pre></div>
</div>
<p>which will reload <code class="docutils literal notranslate"><span class="pre">boom_medium_debug.dcp</span></code> from disk to give the following output:</p>
<a class="reference internal image-reference" href="_images/boom_medium_debug2.png"><img alt="_images/boom_medium_debug2.png" class="align-center" src="_images/boom_medium_debug2.png" style="width: 550px;" /></a>
<p>Notice that there now exists routing (green lines) connecting the design under debug in the upper
portion of the device with the debug core in the lower left corner.
Running <code class="docutils literal notranslate"><span class="pre">report_route_status</span></code> now shows that the design contains no routing errors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Design</span> <span class="n">Route</span> <span class="n">Status</span>
                                               <span class="p">:</span>      <span class="c1"># nets :</span>
   <span class="o">-------------------------------------------</span> <span class="p">:</span> <span class="o">-----------</span> <span class="p">:</span>
   <span class="c1"># of logical nets.......................... :       87675 :</span>
       <span class="c1"># of nets not needing routing.......... :       33814 :</span>
           <span class="c1"># of internally routed nets........ :       30515 :</span>
           <span class="c1"># of nets with no loads............ :        3299 :</span>
       <span class="c1"># of routable nets..................... :       53861 :</span>
           <span class="c1"># of fully routed nets............. :       53861 :</span>
       <span class="c1"># of nets with routing errors.......... :           0 :</span>
   <span class="o">-------------------------------------------</span> <span class="p">:</span> <span class="o">-----------</span> <span class="p">:</span>
</pre></div>
</div>
</div>
<div class="section" id="relocating-the-debug-core">
<h3>5. Relocating the debug core<a class="headerlink" href="#relocating-the-debug-core" title="Permalink to this headline">¶</a></h3>
<p>During the original creation of the debug core, the placer decided to locate it in the bottom
left corner of the device.
Given its distance from the design under debug, routing delays caused by connecting any signals
of interest to this debug core may cause an undesirable performance impact.
RapidWright’s <code class="docutils literal notranslate"><span class="pre">ModuleInst</span></code> functionality allows the debug core to be relocated to legal positions
closer to the design under debug.
For the scope of this tutorial, we will visually identify a new location for placing the debug
core but it should be noted that automated methods also exist.</p>
<p>Using Vivado (which should still have the last <code class="docutils literal notranslate"><span class="pre">boom_medium_debug.dcp</span></code> open) it can be observed
that there are free block RAM resources to the left and right of the design under debug which
would represent better locations for any debug core.</p>
<p>Select and zoom into the following site:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nv">select_objects</span><span class="w"> </span><span class="k">[</span><span class="nv">get_sites</span><span class="w"> </span>RAMB36_X7Y34<span class="k">]</span>
</pre></div>
</div>
<p>Note that this site is unoccupied, and that LUT resources to the right of this RAM resource are
also unoccupied as they are necessary to host a number of GND sources.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">src/EcoInsertRouteDebug.java</span></code> again, comment out the <code class="docutils literal notranslate"><span class="pre">placeOnOriginalAnchor()</span></code>
call and instead place the debug core at this new location, as shown below:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ModuleInst</span><span class="w"> </span><span class="n">debug1ModuleInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">createModuleInst</span><span class="p">(</span><span class="s">&quot;debug1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">debugModule</span><span class="p">);</span>
<span class="c1">// debug1ModuleInst.placeOnOriginalAnchor(); // Comment out this line</span>

<span class="n">Device</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">getDevice</span><span class="p">();</span><span class="w"> </span><span class="c1">// Add this and the following line</span>
<span class="n">debug1ModuleInst</span><span class="p">.</span><span class="na">place</span><span class="p">(</span><span class="n">device</span><span class="p">.</span><span class="na">getSite</span><span class="p">(</span><span class="s">&quot;RAMB36_X7Y34&quot;</span><span class="p">));</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">ModuleInst</span><span class="o">&gt;</span><span class="w"> </span><span class="n">debugInsts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">();</span>
</pre></div>
</div>
<p>Re-compile and execute the modified source code by calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./gradlew<span class="w"> </span>-Dmain<span class="o">=</span>EcoInsertRouteDebug<span class="w"> </span>:run
</pre></div>
</div>
<p>and execute</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>refresh_design
</pre></div>
</div>
<p>inside Vivado to view this latest result. Ensure that this result is also legal with a call to</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>report_route_status
</pre></div>
</div>
</div>
<div class="section" id="inserting-and-routing-multiple-debug-cores">
<h3>6. Inserting and routing multiple debug cores<a class="headerlink" href="#inserting-and-routing-multiple-debug-cores" title="Permalink to this headline">¶</a></h3>
<p>A single debug core (in this example, supporting the tracing of up to 36 signals) may not
be sufficient.
Besides being able to relocate a single <code class="docutils literal notranslate"><span class="pre">ModuleInst</span></code>, RapidWright also supports the
creation of multiple instantiations of the same <code class="docutils literal notranslate"><span class="pre">Module</span></code> object.
Incidentally, the program counter of the BOOM processor is 40-bits wide thus requiring
a second debug core for full visibility.</p>
<p>Edit <code class="docutils literal notranslate"><span class="pre">src/EcoInsertRouteDebug.java</span></code> to create and place a second instantiation, then
connect that up, so that the <code class="docutils literal notranslate"><span class="pre">main</span></code> method looks like the following:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Design</span><span class="w"> </span><span class="n">baseDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Design</span><span class="p">.</span><span class="na">readCheckpoint</span><span class="p">(</span><span class="s">&quot;files/boom_medium_routed.dcp&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Design</span><span class="w"> </span><span class="n">debugDesign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Design</span><span class="p">.</span><span class="na">readCheckpoint</span><span class="p">(</span><span class="s">&quot;files/fifo36_routed.dcp&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kt">boolean</span><span class="w"> </span><span class="n">unrouteStaticNets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="n">Module</span><span class="w"> </span><span class="n">debugModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Module</span><span class="p">(</span><span class="n">debugDesign</span><span class="p">,</span><span class="w"> </span><span class="n">unrouteStaticNets</span><span class="p">);</span>

<span class="w">    </span><span class="n">ModuleInst</span><span class="w"> </span><span class="n">debug1ModuleInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">createModuleInst</span><span class="p">(</span><span class="s">&quot;debug1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">debugModule</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// debug1ModuleInst.placeOnOriginalAnchor();</span>
<span class="w">    </span><span class="n">Device</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">getDevice</span><span class="p">();</span>
<span class="w">    </span><span class="n">debug1ModuleInst</span><span class="p">.</span><span class="na">place</span><span class="p">(</span><span class="n">device</span><span class="p">.</span><span class="na">getSite</span><span class="p">(</span><span class="s">&quot;RAMB36_X7Y34&quot;</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Second instantiation and placement into new site</span>
<span class="w">    </span><span class="c1">// &gt;&gt;&gt;&gt;&gt;</span>
<span class="w">    </span><span class="n">ModuleInst</span><span class="w"> </span><span class="n">debug2ModuleInst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">createModuleInst</span><span class="p">(</span><span class="s">&quot;debug2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">debugModule</span><span class="p">);</span>
<span class="w">    </span><span class="n">debug2ModuleInst</span><span class="p">.</span><span class="na">place</span><span class="p">(</span><span class="n">device</span><span class="p">.</span><span class="na">getSite</span><span class="p">(</span><span class="s">&quot;RAMB36_X4Y41&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// &lt;&lt;&lt;&lt;&lt;</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ModuleInst</span><span class="o">&gt;</span><span class="w"> </span><span class="n">debugInsts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">();</span>
<span class="w">    </span><span class="n">debugInsts</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">debug1ModuleInst</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Addition of second debug core to list of instances</span>
<span class="w">    </span><span class="c1">// &gt;&gt;&gt;&gt;&gt;</span>
<span class="w">    </span><span class="n">debugInsts</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">debug2ModuleInst</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// &lt;&lt;&lt;&lt;&lt;</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">clkName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;clock_uncore_clock_IBUF_BUFG&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">netNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Increase PC from 36 bits to full 40 bits</span>
<span class="w">    </span><span class="c1">// &gt;&gt;&gt;&gt;&gt;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="cm">/*36*/</span><span class="w"> </span><span class="mi">40</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// &lt;&lt;&lt;&lt;&lt;</span>
<span class="w">        </span><span class="n">netNames</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="s">&quot;system/tile_prci_domain/tile_reset_domain_tile/core/csr/s1_pc_reg[&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">EDIFNetlist</span><span class="w"> </span><span class="n">baseNetlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">getNetlist</span><span class="p">();</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">netPinList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buildNetPinList</span><span class="p">(</span><span class="n">baseNetlist</span><span class="p">,</span><span class="w"> </span><span class="n">clkName</span><span class="p">,</span><span class="w"> </span><span class="n">netNames</span><span class="p">,</span><span class="w"> </span><span class="n">debugInsts</span><span class="p">);</span>
<span class="w">    </span><span class="n">ECOTools</span><span class="p">.</span><span class="na">connectNet</span><span class="p">(</span><span class="n">baseDesign</span><span class="p">,</span><span class="w"> </span><span class="n">netPinList</span><span class="p">);</span>

<span class="w">    </span><span class="n">PartialRouter</span><span class="p">.</span><span class="na">routeDesignPartialNonTimingDriven</span><span class="p">(</span><span class="n">baseDesign</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="n">baseDesign</span><span class="p">.</span><span class="na">writeCheckpoint</span><span class="p">(</span><span class="s">&quot;boom_medium_debug.dcp&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Re-compile and execute the modified source code by calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./gradlew<span class="w"> </span>-Dmain<span class="o">=</span>EcoInsertRouteDebug<span class="w"> </span>:run
</pre></div>
</div>
<p>and execute</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>refresh_design
</pre></div>
</div>
<p>inside Vivado to view this latest result.  Again, verify the result by calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>report_route_status
</pre></div>
</div>
<p>and close Vivado once you are satisfied it is legal.</p>
</div>
<div class="section" id="inserting-and-routing-debug-cores-without-leaving-vivado">
<h3>7. Inserting and routing debug cores without leaving Vivado<a class="headerlink" href="#inserting-and-routing-debug-cores-without-leaving-vivado" title="Permalink to this headline">¶</a></h3>
<p>It is possible to adapt the these techniques into a standalone application to be run directly
from and integrated with Vivado.
The source code for this standalone application is located at <code class="docutils literal notranslate"><span class="pre">src/EcoInsertRouteDebugApp.java</span></code>
and differs from that in the prior section by accepting two command-line arguments corresponding
to the input and output DCPs to be processed, and to accept signals for tracing as marked inside
the Vivado GUI.
To build this standalone application, execute the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./gradlew<span class="w"> </span>-Dmain<span class="o">=</span>EcoInsertRouteDebugApp<span class="w"> </span>:fatJar
</pre></div>
</div>
<p>to build an all-in-one “JAR” (Java Archive) file containing all its compiled code and
dependencies.</p>
<p>Next, create a new Tcl source file named <code class="docutils literal notranslate"><span class="pre">eco_insert_route_debug.tcl</span></code> with the following contents:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="c"># Write the design</span>
<span class="nv">write_checkpoint</span><span class="w"> </span><span class="o">-</span>force<span class="w"> </span>eco_input.dcp
<span class="nv">write_edif</span><span class="w"> </span><span class="o">-</span>force<span class="w"> </span>eco_input.edf
<span class="c"># Execute the EcoInsertRouteDebugApp.jar and display its output upon exit</span>
<span class="nb">puts</span><span class="w"> </span><span class="k">[</span><span class="nb">exec</span><span class="w"> </span>java<span class="w"> </span><span class="o">-</span>jar<span class="w"> </span>EcoInsertRouteDebugApp.jar<span class="w"> </span>eco_input.dcp<span class="w"> </span>eco_output.dcp<span class="k">]</span>
<span class="c"># Close the old checkpoint</span>
<span class="nv">close_design</span>
<span class="c"># Re-open the modified checkpoint</span>
<span class="nv">open_checkpoint</span><span class="w"> </span>eco_output.dcp
<span class="c"># Check design is fully routed</span>
<span class="nv">report_route_status</span>
<span class="c"># Find all signals marked for debug and display them in a new GUI tab</span>
<span class="nv">show_objects</span><span class="w"> </span><span class="o">-</span>name<span class="w"> </span>find_1<span class="w"> </span><span class="k">[</span><span class="nv">get_nets</span><span class="w"> </span><span class="o">-</span>hierarchical<span class="w"> </span><span class="o">-</span>top_net_of_hierarchical_group<span class="w"> </span><span class="o">-</span>filter<span class="w"> </span><span class="k">{</span><span class="w"> </span><span class="nv">MARK_DEBUG</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;TRUE&quot;</span><span class="w"> </span><span class="k">}</span><span class="w"> </span><span class="k">]</span>
</pre></div>
</div>
<p>Lastly, launch Vivado with our original base design once again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vivado<span class="w"> </span>files/boom_medium_routed.dcp
</pre></div>
</div>
<p>We will use the “Mark Debug” feature within the Vivado GUI to select the signals to be connected
to the debug core.
From the “Netlist” tab in the left hand side, open up the top-level “Nets” folder and right click on
the <code class="docutils literal notranslate"><span class="pre">tl_slave_0_a_bits_data_OBUF</span> <span class="pre">(64)</span></code> entry and select “Mark Debug” as shown below:</p>
<a class="reference internal image-reference" href="_images/boom_medium_debug3.png"><img alt="_images/boom_medium_debug3.png" class="align-center" src="_images/boom_medium_debug3.png" style="width: 550px;" /></a>
<p>From the Tcl Console, execute the previously created script in the following manner:</p>
<div class="highlight-tcl notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>eco_insert_route_debug.tcl
</pre></div>
</div>
<p>As the comments in the Tcl script indicate, this causes the base design (with signals marked for
debug) to be written to disk, operated on by the <code class="docutils literal notranslate"><span class="pre">EcoInsertRouteDebugApp</span></code> and then re-opened
in Vivado, all without leaving the Vivado interface.
Verify that all traced nets are indeed fully routed.</p>
</div>
<div class="section" id="closing-comments">
<h3>8. Closing Comments<a class="headerlink" href="#closing-comments" title="Permalink to this headline">¶</a></h3>
<p>In this tutorial, we’ve demonstrated how RapidWright can be used as part of a custom
application that is capable of inserting, relocating, connecting and routing
one or more debug cores (trace buffers) without disrupting the existing placement and
routing of the base design.</p>
<p>More specifically, we’ve demonstrated how RapidWright’s <code class="docutils literal notranslate"><span class="pre">Module</span></code> capabilities can be used
to insert and relocate designs within other designs, how <code class="docutils literal notranslate"><span class="pre">ECOTools</span></code> can be used to connect
nets and pins from such merged designs, and how <code class="docutils literal notranslate"><span class="pre">PartialRouter</span></code> can be used to incrementally
route just the unrouted pins.</p>
<p>Beyond those, RapidWright contains many more capabilities – for example, <code class="docutils literal notranslate"><span class="pre">ECOTools</span></code>
supports the ability to also disconnect pins from nets, remove cells, create new nets
and cells, etc.
<a class="reference external" href="https://www.rapidwright.io/docs/PreImplemented_Modules_Part_I.html">Pre-implemented Modules</a>
is a separate tutorial that discusses <code class="docutils literal notranslate"><span class="pre">Module</span></code>-s in more details, in which a manual
<code class="docutils literal notranslate"><span class="pre">HandPlacer</span></code> (with GUI) and automated simulated-annealing based <code class="docutils literal notranslate"><span class="pre">BlockPlacer</span></code> are both
described and could be adapted to ease the process for finding module placements.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="SLR_Crosser_DCP_Creator_Tutorial.html" class="btn btn-neutral float-right" title="Create Placed and Routed DCP to Cross SLR" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="PolynomialGenerator.html" class="btn btn-neutral" title="Polynomial Generator: Placed and Routed Circuits in Seconds" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2024, Advanced Micro Devices, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2023.2.2-beta',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
      <script type="text/javascript" src="_static/copybutton.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>